# MicroBoard 功能文档

## 📋 目录

- [核心功能](#核心功能)
- [公告板系统](#公告板系统)
- [会员管理](#会员管理)
- [社交登录](#社交登录)
- [积分系统](#积分系统)
- [插件系统](#插件系统)
- [多语言支持](#多语言支持)
- [管理功能](#管理功能)
- [安全功能](#安全功能)

---

## 🌟 核心功能

MicroBoard 是一个轻量级、高性能的公告板系统，允许您在没有大型 CMS 的复杂性的情况下构建强大的社区平台。

### 主要功能

- ⚡ **轻量 & 快速**: 优化性能，最小化依赖
- 🌍 **全球支持**: 支持 4 种语言（韩语、英语、日语、中文）
- 🔐 **强大安全性**: CSRF、SQL 注入、XSS 防护
- 📱 **响应式设计**: 所有设备上的完美用户体验
- 🔌 **可扩展**: 通过插件系统无限扩展

---

## 📝 公告板系统

### 基本公告板功能

MicroBoard 的公告板提供直观且强大的功能。

#### ✨ 发布文章

- **所见即所得编辑器**: 使用 Summernote 编辑器进行富文本编辑
- **图片上传**: 通过拖放轻松附加图片
- **文件附件**: 支持各种文件格式
- **实时预览**: 编写时立即预览

#### 🔍 搜索功能

- **综合搜索**: 按标题、内容和作者搜索
- **过滤**: 选择特定字段进行搜索
- **排序**: 按最新或浏览量排序

#### 💬 评论系统

- **分层评论**: 支持评论和回复
- **实时注册**: 无需刷新页面即可发布评论
- **作者显示**: 显示评论作者信息

#### 📊 浏览跟踪

- **基于 IP 的重复防止**: 防止重复浏览
- **实时聚合**: 实时更新浏览次数

#### 📂 文件管理

- **多文件附件**: 同时上传多个文件
- **文件下载**: 下载并计数附加文件
- **自动清理**: 删除文章时自动删除相关文件

#### 📋 公告板目录

- **卡片布局**: 卡片式列表，一目了然地查看所有公告板
- **响应式设计**: 即使在移动设备上也能清晰显示的网格系统
- **自动生成**: 添加公告板时自动反映在列表中

---

## 页面管理 (Page Management)

您可以在 MicroBoard 中直接创建和管理静态页面（如公司介绍，使用条款等）。

### 主要功能
- **创建页面**: 在管理面板中设置标题，内容和 URL Slug
- **权限设置**: 为每个页面设置阅读权限级别（访客，会员专用等）
- **使用变量**: 在页面内容中可以使用 `{{变量名}}` 形式插入动态数据
- **URL 访问**: 通过 `page.php?id=Slug` 形式访问

### 自定义变量 (Custom Variables)
- 在管理设置页面中定义您自己的变量。
- **示例**: 创建一个名为 `{{twitter_url}}` 的变量并将其值设置为链接，当在帖子或页面正文中输入 `{{twitter_url}}` 时，它将自动替换为该链接。
- **默认变量**:
  - `{{site_title}}`: 网站标题
  - `{{copyright}}`: 版权文本
  - `{{username}}`: 当前用户 ID
  - `{{nickname}}`: 当前用户昵称
  - `{{year}}`: 当前年份

---

## 👥 会员管理

### 会员注册和认证

#### 📋 会员注册

- **简单注册流程**: 仅需 ID 和密码即可注册
- **实时重复检查**: 立即检查 ID 是否重复
- **密码加密**: 使用 bcrypt 安全存储密码
- **输入验证**: 通过服务器端输入验证增强安全性

#### 🔐 登录系统

- **会话管理**: 基于会话的安全认证
- **自动注销**: 30 分钟不活动后自动注销
- **记住我**: 保持登录状态的选项
- **多种登录方式**: 普通登录 + 社交登录

### 会员等级系统

#### 🏆 等级管理

- **10 级系统**: 会员等级系统从 1 到 10 级
- **基于等级的权限**: 基于等级的访问控制
- **自动晋升**: 基于活动积分自动调整等级（可选）
- **手动管理**: 管理员可以直接调整等级

#### 🚫 会员制裁

- **封禁功能**: 封禁有问题的会员
- **封禁原因记录**: 记录封禁原因和日期
- **解除封禁**: 管理员可以随时解除封禁
- **自动通知**: 向被封禁会员显示原因

#### 👤 会员资料

- **活动历史**: 查看发布的文章和评论
- **积分历史**: 详细记录获得/扣除的积分
- **加入信息**: 显示加入日期和最后登录日期

---

## 🔐 社交登录 (OAuth)

MicroBoard 提供与主要社交平台的无缝集成。

### 支持的平台

#### 🔵 Google OAuth

- **Google 账户登录**: 使用 Google 账户一键登录
- **自动账户创建**: 首次登录时自动创建会员
- **资料集成**: 自动获取 Google 资料信息
- **设置**: 在 [Google Cloud Console](https://console.cloud.google.com/) 中配置

#### 🟢 LINE OAuth

- **LINE 账户登录**: 与 LINE 应用集成的登录
- **移动优化**: 为移动环境优化的登录流程
- **自动账户创建**: 首次登录时自动创建会员
- **设置**: 在 [LINE Developers](https://developers.line.biz/) 中配置

#### ⚫ Apple OAuth

- **使用 Apple 登录**: 使用 Apple ID 进行安全登录
- **隐私保护**: Apple 强大的隐私保护功能
- **iOS 优化**: 在 iOS/macOS 设备上优化的体验
- **设置**: 在 [Apple Developer](https://developer.apple.com/) 中配置

### OAuth 功能

- ✅ **自动按钮显示**: 配置完成时自动显示登录按钮
- ✅ **状态显示**: 在管理页面检查 OAuth 配置状态
- ✅ **CSRF 防护**: 使用 State 参数防止 CSRF 攻击
- ✅ **错误处理**: 详细的错误消息和日志记录
- ✅ **多语言支持**: 所有 OAuth 流程中的多语言支持

### 设置方法

1. 访问管理页面 (`/admin/oauth.php`)
2. 输入每个平台的 Client ID 和 Secret
3. 选择启用复选框
4. 保存后将自动显示登录按钮

---

## ⭐ 积分系统

鼓励会员活动的积分系统。

### 积分累积

#### 📝 发布文章

- **自动累积**: 发布文章时自动累积积分
- **管理员设置**: 管理员可以设置累积积分
- **差异累积**: 不同公告板的不同积分设置（可选）

#### 💬 发布评论

- **评论积分**: 发布评论时累积积分（可选）
- **鼓励活动**: 鼓励积极参与社区

### 积分扣除

#### 🗑️ 删除文章

- **自动扣除**: 删除文章时自动扣除获得的积分
- **防止滥用**: 防止通过反复发布/删除来累积积分

### 积分管理

#### 📊 积分历史

- **详细记录**: 记录所有积分累积/扣除历史
- **按日期查看**: 按日期查看积分历史
- **显示原因**: 清晰显示积分变化的原因

#### ⚙️ 管理员设置

- **开/关**: 启用/禁用积分系统
- **积分设置**: 设置文章/评论的积分
- **手动授予**: 管理员可以直接授予/扣除积分

---

## 🔌 插件系统

MicroBoard 提供强大的基于钩子的插件系统。

### 插件结构

#### 📁 插件目录

```
/plugin
  /your_plugin_name
    - plugin.php (主插件文件)
    - config.json (插件设置)
    - README.md (插件说明)
```

### 钩子系统

#### 🎯 事件钩子

MicroBoard 在各种时间执行钩子:

- `before_write`: 发布文章前
- `after_write`: 发布文章后
- `before_delete`: 删除文章前
- `after_delete`: 删除文章后
- `before_comment`: 发布评论前
- `after_comment`: 发布评论后
- `before_login`: 登录前
- `after_login`: 登录后

#### 📌 插件注册

```php
// plugin.php 示例
add_event('after_write', function($post_data) {
    // 发布文章后执行的代码
    error_log("新文章已创建: " . $post_data['title']);
}, 10); // 优先级 10
```

### 插件功能

#### ⚙️ 插件管理

- **自动加载**: 自动识别 `/plugin` 文件夹中的插件
- **启用/禁用**: 在管理页面中打开/关闭插件
- **特定公告板应用**: 仅将插件应用于特定公告板
- **优先级**: 控制多个插件的执行顺序

#### 🛠️ 插件示例

```php
<?php
/**
 * Plugin Name: Hello World
 * Description: 简单的插件示例
 * Version: 1.0.0
 */

// 发布文章后记录日志
add_event('after_write', function($post_data) {
    $log = "[" . date('Y-m-d H:i:s') . "] ";
    $log .= "新文章: " . $post_data['title'];
    file_put_contents(__DIR__ . '/log.txt', $log . PHP_EOL, FILE_APPEND);
});

// 发布评论时通知
add_event('after_comment', function($comment_data) {
    // 实现电子邮件通知、推送通知等
    notify_admin($comment_data);
});
?>
```

---

## 🌍 多语言支持

MicroBoard 提供完美的多语言支持，适用于全球服务。

### 支持的语言

#### 🇰🇷 韩语 (Korean)

- 完美的韩语翻译
- 韩国式的日期/时间格式
- 为韩国服务优化

#### 🇺🇸 英语 (English)

- 本地级别的英语翻译
- 国际标准的日期/时间格式
- 全球服务支持

#### 🇯🇵 日语 (Japanese)

- 自然的日语翻译
- 日式敬语表达
- 为日语服务优化

#### 🇨🇳 中文 (Chinese)

- 精确的中文翻译（简体）
- 中式表达方式
- 中文服务支持

### 多语言功能

#### 🔄 自动语言检测

- **浏览器语言**: 自动检测用户的浏览器设置
- **基于 IP**: 通过 IP 地址确定国家（可选）
- **Cookie 存储**: 自动保存所选语言

#### 🎛️ 语言切换

- **语言选择器**: 所有页面上的语言选择菜单
- **即时切换**: 无需刷新页面即可更改语言
- **URL 参数**: 以 `?lang=ko` 格式指定语言

#### 📝 翻译管理

- **语言文件**: `/lang/` 文件夹中的特定语言 PHP 文件
- **轻松添加**: 通过添加新的语言文件来扩展语言
- **覆盖**: 自定义特定短语

---

## 👨‍💼 管理功能

提供强大且直观的管理页面。

### 仪表板

#### 📊 统计

- **会员统计**: 总会员数、新注册、活跃会员
- **文章统计**: 总文章数、每日文章数
- **访问者统计**: 每日访问者、页面浏览量
- **系统信息**: 服务器状态、磁盘使用情况

### 会员管理

#### 👥 会员列表

- **查看所有会员**: 按注册日期或名称排序
- **详细信息**: 每个会员的活动历史和积分
- **批量操作**: 同时管理多个会员

#### 🔧 会员控制

- **等级变更**: 批量或单个等级变更
- **封禁/解禁**: 封禁和解禁有问题的会员账户
- **删除**: 完全删除会员及相关数据
- **积分管理**: 手动授予/扣除积分

### 公告板管理

#### 📋 公告板设置

- **创建公告板**: 创建新的公告板
- **权限设置**: 设置读取/写入权限等级
- **皮肤选择**: 为每个公告板应用不同的皮肤
- **列表数量**: 设置每页显示的文章数量

#### 🎨 皮肤管理

- **皮肤列表**: 查看已安装的皮肤列表
- **预览**: 在应用皮肤前预览
- **设置**: 为每个皮肤设置详细选项

### OAuth 管理

#### 🔐 OAuth 设置

- **Google 设置**: 输入 Client ID、Secret 并启用
- **LINE 设置**: 管理 Channel ID、Secret
- **Apple 设置**: 管理 Team ID、Key ID、Private Key
- **状态检查**: 实时检查 OAuth 集成状态

### 系统设置

#### ⚙️ 基本设置

- **站点标题**: 站点名称和描述
- **管理员电子邮件**: 用于系统通知的电子邮件
- **默认语言**: 设置站点的默认语言
- **时区**: 设置服务器时区

#### 💰 积分设置

- **积分使用**: 打开/关闭积分系统
- **文章积分**: 发布文章时获得的积分
- **评论积分**: 发布评论时获得的积分
- **登录积分**: 每日登录奖励积分

### 策略管理

#### 📜 策略页面和自动安装

- **自动安装**: 安装过程中自动注册 4 种语言（韩/英/日/中）的服务条款和隐私策略
- **自动显示**: 自动显示用户语言设置中的策略
- **服务条款**: 创建/编辑服务条款
- **隐私策略**: 管理隐私策略
- **所见即所得编辑器**: 策略内容编辑器
- **版本管理**: 保留策略变更历史

---

## 🔒 安全功能

MicroBoard 使用最新的安全技术保护您的网站。

### 认证安全

#### 🔐 密码安全

- **bcrypt 加密**: 行业标准的密码哈希
- **盐**: 自动生成盐以防止彩虹表攻击
- **重新哈希**: 更改密码时自动重新哈希

#### ⏰ 会话安全

- **会话超时**: 30 分钟不活动后自动注销
- **会话再生成**: 登录时重新生成会话 ID
- **安全 Cookie**: 在 HTTPS 环境中使用 Secure 标志

### 输入安全

#### 🛡️ SQL 注入防护

- **PDO Prepared Statements**: 在所有查询中使用 Prepared Statement
- **输入验证**: 服务器端验证所有用户输入
- **类型检查**: 严格验证数据类型（数字/字符串等）

#### 🚫 XSS 防护

- **htmlspecialchars**: 输出时转义所有 HTML
- **DOM Purify**: 客户端 XSS 防护
- **内容安全策略**: 使用 CSP 头阻止脚本注入

#### 🔒 CSRF 防护

- **CSRF 令牌**: 在所有表单中自动生成 CSRF 令牌
- **令牌验证**: 提交表单时验证令牌
- **SameSite Cookie**: 设置 Cookie 的 SameSite 属性

### 文件安全

#### 📁 上传安全

- **文件类型验证**: 基于白名单的文件扩展名验证
- **文件大小限制**: 最大上传大小限制
- **随机化文件名**: 自动更改上传的文件名
- **执行防护**: 阻止上传目录中的脚本执行

### 访问控制

#### 🚪 权限管理

- **基于等级的访问**: 基于会员等级的访问控制
- **管理员认证**: 管理页面的二段阶认证
- **IP 白名单**: 仅允许特定 IP 访问管理（可选）

#### 🔐 双重认证(2FA)

- **基于邮件的双重认证**: 通过基于邮件的双重认证增强账户安全性
- **认证应用支持**: 与 Google Authenticator、Authy 等 TOTP 应用兼容
- **QR 码设置**: 通过扫描 QR 码轻松设置
- **备份代码**: 用于账户恢复的一次性备份代码
- **管理员控制**: 通过邮件设置全局启用/禁用 2FA
- **用户控制**: 用户可以在个人资料设置中启用/禁用 2FA
- **安全登录**: 用户账户的额外安全层

#### 🎨 主题自定义

- **网站图标上传**: 上传自定义网站图标（ICO、PNG、JPG、GIF 格式）
- **标志上传**: 上传自定义标志（PNG、JPG、GIF、SVG 格式）
- **大小控制**: 选择适当的大小（网站图标：16x16、32x32、64x64；标志：150x40、200x50、250x60、300x75）
- **安全性**: 文件大小验证（最大 5MB）、MIME 类型验证、SVG 内容清理
- **预览**: 查看当前网站图标和标志及其尺寸
- **管理员控制**: 通过直观的管理界面管理网站品牌

---

## 📦 附加功能

### � 电子邮件通知（可选）

- 会员注册欢迎邮件
- 评论通知邮件
- 密码重置邮件
- 管理员通知邮件

### � SEO 优化

- 自动生成元标签
- 自动生成站点地图
- Robots.txt 管理
- URL 结构优化

### � 日志记录

- 错误日志记录
- 访问日志记录
- 管理员操作日志
- 日志保留和删除策略

---

## 🚀 性能优化

### ⚡ 缓存

- 数据库查询缓存
- 页面缓存（可选）
- 静态文件缓存

### � 优化

- 自动图像压缩
- CSS/JS 压缩和合并
- 懒加载
- CDN 支持

---

## � 移动支持

### � 响应式设计

- **完美响应式**: 为所有屏幕尺寸优化
- **触摸优化**: 支持触摸界面
- **移动菜单**: 移动专用导航
- **快速加载**: 为移动环境优化

---

## 🔄 更新和迁移

### 📥 更新

- **自动更新检查**: 自动检测新版本
- **一键更新**: 通过一个按钮更新
- **自动备份**: 更新前自动备份

### � 迁移

- **数据库迁移**: 自动更新每个版本的 DB 模式
- **设置保留**: 保留现有设置和数据
- **回滚支持**: 如果出现问题，恢复到之前的版本

---

## � 支持和社区

### � 支持

- **GitHub Issues**: 错误报告和功能请求
- **文档**: 详细的在线文档
- **FAQ**: 常见问题

### 🤝 社区

- **GitHub Discussions**: 社区讨论
- **贡献指南**: 开源贡献方法
- **插件共享**: 社区插件

---

## � 许可证

MicroBoard 根据 [MIT 许可证](LICENSE) 发布。

---

**MicroBoard v1.0.0** | [文档](https://mytajimilife-coder.github.io/microboard/) | [GitHub](https://github.com/mytajimilife-coder/microboard)
